{% extends "layout.html" %}

{% block title %}Create Account - NumeriLogic{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 py-12 px-4 sm:px-6 lg:px-8 flex items-center justify-center">
  <div class="w-full max-w-md">
    <!-- Register Card -->
    <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
      <!-- Header -->
      <div class="bg-gradient-to-r from-green-600 to-emerald-600 text-white px-8 py-12">
        <div class="text-center mb-6">
          <div class="inline-block bg-white bg-opacity-20 rounded-lg p-3 backdrop-blur mb-4">
            <i class="fas fa-user-plus text-4xl"></i>
          </div>
        </div>
        <h1 class="text-3xl font-bold text-center">Join NumeriLogic</h1>
        <p class="text-green-100 text-center mt-2">Create your account to get started</p>
      </div>

      <!-- Form -->
      <div class="px-8 py-10">
        <!-- Alerts -->
        <div id="errorAlert" class="hidden mb-4 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-r-lg" role="alert">
          <p class="font-bold text-sm">Error</p>
          <span id="errorMessage" class="block text-sm"></span>
        </div>

        <div id="successAlert" class="hidden mb-4 bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-r-lg" role="alert">
          <p class="font-bold text-sm">Success</p>
          <span id="successMessage" class="block text-sm"></span>
        </div>

        <form id="registrationForm" class="space-y-4">
          <!-- Username -->
          <div>
            <label for="username" class="block text-sm font-bold text-gray-700 mb-2">
              <i class="fas fa-user text-green-600 mr-2"></i>Username
            </label>
            <input type="text" id="username" name="username" required
                   class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition"
                   placeholder="Choose a username">
          </div>

          <!-- Email -->
          <div>
            <label for="email" class="block text-sm font-bold text-gray-700 mb-2">
              <i class="fas fa-envelope text-green-600 mr-2"></i>Email
            </label>
            <input type="email" id="email" name="email" required
                   class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition"
                   placeholder="your@email.com">
          </div>

          <!-- First Name -->
          <div>
            <label for="first_name" class="block text-sm font-bold text-gray-700 mb-2">
              <i class="fas fa-id-card text-green-600 mr-2"></i>First Name
            </label>
            <input type="text" id="first_name" name="first_name" required
                   class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition"
                   placeholder="John">
          </div>

          <!-- Last Name -->
          <div>
            <label for="last_name" class="block text-sm font-bold text-gray-700 mb-2">
              <i class="fas fa-id-card text-green-600 mr-2"></i>Last Name
            </label>
            <input type="text" id="last_name" name="last_name" required
                   class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition"
                   placeholder="Doe">
          </div>

          <!-- Password -->
          <div>
            <label for="password" class="block text-sm font-bold text-gray-700 mb-2">
              <i class="fas fa-lock text-green-600 mr-2"></i>Password
            </label>
            <input type="password" id="password" name="password" required
                   class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition"
                   placeholder="Enter a strong password">
          </div>

          <!-- Confirm Password -->
          <div>
            <label for="confirm_password" class="block text-sm font-bold text-gray-700 mb-2">
              <i class="fas fa-check-circle text-green-600 mr-2"></i>Confirm Password
            </label>
            <input type="password" id="confirm_password" name="confirm_password" required
                   class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-200 transition"
                   placeholder="Confirm your password">
          </div>

          <!-- Submit Button -->
          <button type="submit" 
                  class="w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:shadow-lg text-white font-bold py-3 px-4 rounded-lg transition transform hover:scale-105 flex items-center justify-center space-x-2 mt-6">
            <i class="fas fa-user-plus"></i>
            <span>Create Account</span>
          </button>
        </form>

        <!-- Divider -->
        <div class="relative my-6">
          <div class="absolute inset-0 flex items-center">
            <div class="w-full border-t border-gray-300"></div>
          </div>
          <div class="relative flex justify-center text-sm">
            <span class="px-2 bg-white text-gray-500">Already registered?</span>
          </div>
        </div>

        <!-- Login Link -->
        <a href="/login" class="w-full block text-center bg-gray-100 hover:bg-gray-200 text-gray-800 font-bold py-3 px-4 rounded-lg transition">
          <i class="fas fa-sign-in-alt mr-2"></i>Sign In Instead
        </a>
      </div>

      <!-- Footer -->
      <div class="bg-gray-50 px-8 py-4 border-t border-gray-200 text-center text-xs text-gray-600">
        <p>Join thousands using NumeriLogic for advanced calculations</p>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('registrationForm');
    const errorAlert = document.getElementById('errorAlert');
    const errorMessage = document.getElementById('errorMessage');
    const successAlert = document.getElementById('successAlert');
    const successMessage = document.getElementById('successMessage');

    function showError(message) {
        errorMessage.textContent = message;
        errorAlert.classList.remove('hidden');
        successAlert.classList.add('hidden');
    }

    function showSuccess(message) {
        successMessage.textContent = message;
        successAlert.classList.remove('hidden');
        errorAlert.classList.add('hidden');
    }

    function isValidEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    }

    function isValidPassword(password) {
        return password.length >= 8 && 
               /[A-Z]/.test(password) && 
               /[a-z]/.test(password) && 
               /[0-9]/.test(password); 
    }

    form.addEventListener('submit', async function(e) {
        e.preventDefault();

        errorAlert.classList.add('hidden');
        successAlert.classList.add('hidden');

        // Get form data
        const formData = {
            username: form.username.value.trim(),
            email: form.email.value.trim(),
            password: form.password.value,
            confirm_password: form.confirm_password.value,
            first_name: form.first_name.value.trim(),
            last_name: form.last_name.value.trim()
        };

        // Client-side validation
        if (!formData.username || formData.username.length < 3) {
            showError('Username must be at least 3 characters long');
            return;
        }

        if (!isValidEmail(formData.email)) {
            showError('Please enter a valid email address');
            return;
        }

        if (!isValidPassword(formData.password)) {
            showError('Password must be at least 8 characters long and contain uppercase, lowercase, and numbers');
            return;
        }

        if (formData.password !== formData.confirm_password) {
            showError('Passwords do not match');
            return;
        }

        try {
            const response = await fetch('/auth/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            });

            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.detail || 'Registration failed');
            }

            showSuccess('Registration successful! Redirecting to login...');

            // Redirect to login page after 2 seconds
            setTimeout(() => {
                window.location.href = '/login';
            }, 2000);

        } catch (error) {
            showError(error.message || 'An error occurred during registration');
        }
    });

    const passwordInput = form.password;
    const confirmPasswordInput = form.confirm_password;

    function validatePasswordMatch() {
        if (confirmPasswordInput.value && passwordInput.value !== confirmPasswordInput.value) {
            confirmPasswordInput.setCustomValidity("Passwords don't match");
        } else {
            confirmPasswordInput.setCustomValidity('');
        }
    }

    passwordInput.addEventListener('change', validatePasswordMatch);
    confirmPasswordInput.addEventListener('keyup', validatePasswordMatch);
});
</script>
{% endblock %}